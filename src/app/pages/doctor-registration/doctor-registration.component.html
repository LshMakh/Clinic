<!-- doctor-registration.component.html -->
<div class="registration">
  <h2 class="header">რეგისტრაცია</h2>
  
  <div *ngIf="errorMessage" class="error-alert">
      {{ errorMessage }}
  </div>
  
  <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
      <div class="row1">
          <div class="input-container">
              <div class="input">
                  <label for="firstName">სახელი</label>
                  <input type="text" id="firstName" formControlName="firstName" placeholder="(მინიმუმ 2 სიმბოლო)">
                  <div *ngIf="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched" 
                       class="error-message">
                      სახელის ველის შევსება აუცილებელია
                  </div>
              </div>
          </div>
          <div class="input-container">
              <div class="input">
                  <label for="email">Email</label>
                  <div class="input-wrapper">
                      <input type="email" 
                             id="email" 
                             formControlName="email"
                             [class.is-pending]="email?.pending"
                             [class.is-invalid]="email?.errors && email?.touched">
                      <div class="spinner" *ngIf="email?.pending"></div>
                  </div>
                  <div class="error-messages">
                      <div *ngIf="email?.errors?.['required'] && email?.touched" 
                           class="error-message">
                          Email is required
                      </div>
                      <div *ngIf="email?.errors?.['email'] && email?.touched" 
                           class="error-message">
                          Please enter a valid email
                      </div>
                      <div *ngIf="email?.errors?.['emailExists']" 
                           class="error-message">
                          This email is already in use
                      </div>
                  </div>
              </div>
          </div>
          <div class="input-container">
              <div class="input">
                  <label for="personalNumber">პირადი ნომერი</label>
                  <input type="text" id="personalNumber" formControlName="personalNumber" placeholder="00000000000">
                  <div *ngIf="registerForm.get('personalNumber')?.invalid && registerForm.get('personalNumber')?.touched" 
                       class="error-message">
                      პირადი ნომრის ველის შევსება აუცილებელია
                  </div>
              </div>
          </div>
      </div>

      <div class="row2">
          <div class="input-container">
              <div class="input">
                  <label for="lastName">გვარი</label>
                  <input type="text" id="lastName" formControlName="lastName">
                  <div *ngIf="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched" 
                       class="error-message">
                      გვარის ველის შევსება აუცილებელია
                  </div>
              </div>
          </div>
          <div class="input-container">
              <div class="input">
                  <label for="specialty">სპეციალობა</label>
                  <input type="text" id="specialty" formControlName="specialty" 
                         placeholder="შეიყვანეთ სპეციალობა">
                  <div *ngIf="registerForm.get('specialty')?.invalid && registerForm.get('specialty')?.touched" 
                       class="error-message">
                      სპეციალობის ველის შევსება აუცილებელია
                  </div>
              </div>
          </div>
          <div class="input-container">
              <div class="input">
                  <label for="password">პაროლი</label>
                  <input type="password" id="password" formControlName="password" placeholder="(მინიმუმ 8 სიმბოლო)">
                  <div *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched" 
                       class="error-message">
                      პაროლის ველის შევსება აუცილებელია
                  </div>
              </div>
          </div>
      </div>

      <div class="row3">
          <div class="input-container">
              <div class="input">
                  <label for="photoUrl">ფოტოს ატვირთვა</label>
                  <div class="file-input-wrapper">
                      <input type="file"
                             id="photoUpload"
                             accept="image/jpeg,image/png"
                             (change)="onPhotoSelected($event)"
                             #photoInput>
                      <div class="custom-file-input" (click)="photoInput.click()">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M5 19H19V5H5V19ZM19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3Z" fill="#053354" fill-opacity="0.3"/>
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M9 14L11.03 16.71L14 13L18 18H6" fill="#053354" fill-opacity="0.3"/>
                          </svg>
                          <span>{{ photoFileName || 'აირჩიეთ ფოტო' }}</span>
                      </div>
                  </div>
                  <div *ngIf="registerForm.get('photoFile')?.errors?.['maxSize']" class="error-message">
                      ფოტო არ უნდა აღემატებოდეს 5MB-ს
                  </div>
                  <div *ngIf="registerForm.get('photoFile')?.errors?.['invalidType']" class="error-message">
                      დასაშვებია მხოლოდ JPEG და PNG ფორმატები
                  </div>
              </div>
          </div>

          <div class="input-container">
              <div class="input">
                  <label for="cvUrl">CV-ის ატვირთვა</label>
                  <div class="file-input-wrapper">
                      <input type="file"
                             id="cvUpload"
                             accept="application/pdf"
                             (change)="onCVSelected($event)"
                             #cvInput>
                      <div class="custom-file-input" (click)="cvInput.click()">
                          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <g clip-path="url(#clip0_35_2470)">
                                  <path d="M5 0C2.94434 0 1.25 1.69434 1.25 3.75V16.25C1.25 18.3057 2.94434 20 5 20H8.75C9.43848 20 10 19.4385 10 18.75C10 18.0615 9.43848 17.5 8.75 17.5H5C4.28711 17.5 3.75 16.9629 3.75 16.25V3.75C3.75 3.03711 4.28711 2.5 5 2.5H11.9824L16.25 6.76758V7.5C16.25 8.18848 16.8115 8.75 17.5 8.75C18.1885 8.75 18.75 8.18848 18.75 7.5V6.25C18.75 5.91797 18.6182 5.60059 18.3838 5.36621L13.3838 0.366211C13.1494 0.131836 12.832 0 12.5 0L5 0ZM13.75 10V13.75H10V16.25H13.75V20H16.25V16.25H20V13.75H16.25V10H13.75Z" fill="#053354" fill-opacity="0.3"/>
                              </g>
                              <defs>
                                  <clipPath id="clip0_35_2470">
                                      <rect width="20" height="20" fill="white"/>
                                  </clipPath>
                              </defs>
                          </svg>
                          <span>{{ cvFileName || 'აირჩიეთ ფაილი' }}</span>
                      </div>
                  </div>
                  <div *ngIf="registerForm.get('cvFile')?.errors?.['maxSize']" class="error-message">
                      CV არ უნდა აღემატებოდეს 10MB-ს
                  </div>
                  <div *ngIf="registerForm.get('cvFile')?.errors?.['invalidType']" class="error-message">
                    დასაშვებია მხოლოდ PDF ფორმატი
                </div>
            </div>
        </div>
    </div>
    <button type="submit" class="btn" [disabled]="!registerForm.valid || isSubmitting">
      {{ isSubmitting ? 'მიმდინარეობს...' : 'რეგისტრაცია' }}
  </button>
</form>
</div>